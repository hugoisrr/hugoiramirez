{"componentChunkName":"component---src-templates-page-js","path":"/websocket-usecontext","result":{"data":{"markdownRemark":{"frontmatter":{"title":"Store data from WebSocket in useContext","date":"02 April 2020","path":"/websocket-usecontext","author":"Hugo I. Ramirez","excerpt":"With the increment of devices an application in IoT, we have found an increment of applications that are using WebSockets, but how do we define when to use this technology.","tags":["react","react hooks"],"coverImage":{"childImageSharp":{"fluid":{"base64":"data:image/jpeg;base64,/9j/2wBDABALDA4MChAODQ4SERATGCgaGBYWGDEjJR0oOjM9PDkzODdASFxOQERXRTc4UG1RV19iZ2hnPk1xeXBkeFxlZ2P/2wBDARESEhgVGC8aGi9jQjhCY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2P/wgARCAANABQDASIAAhEBAxEB/8QAFgABAQEAAAAAAAAAAAAAAAAAAwQA/8QAFgEBAQEAAAAAAAAAAAAAAAAAAwAB/9oADAMBAAIQAxAAAAGVpSYKces//8QAGRABAAMBAQAAAAAAAAAAAAAAAQACEQNB/9oACAEBAAEFAvbgMzb2sw7uf//EABgRAAMBAQAAAAAAAAAAAAAAAAABAhET/9oACAEDAQE/AZhNYcT/xAAYEQADAQEAAAAAAAAAAAAAAAAAAQIRE//aAAgBAgEBPwGraenY/8QAGRAAAgMBAAAAAAAAAAAAAAAAAAEQITFh/9oACAEBAAY/AisniMTP/8QAHBABAAIBBQAAAAAAAAAAAAAAAQARQSExUWGB/9oACAEBAAE/ISqCns5xdxK3lFvBEVq4CFI0MpP/2gAMAwEAAgADAAAAELv/AP/EABoRAQABBQAAAAAAAAAAAAAAAAEAESFBUXH/2gAIAQMBAT8Q3PZr2Lwz/8QAGREAAgMBAAAAAAAAAAAAAAAAAAERMUFx/9oACAECAQE/EIGqo4JdR//EABwQAQEAAgIDAAAAAAAAAAAAAAERADEhUUFxgf/aAAgBAQABPxBkUF8uPuHkzQ8h9Yigj047sDZ3igNwjZZjw8QqZn//2Q==","aspectRatio":1.5037593984962405,"src":"/static/08d14f0668b061c1b7bb47aeaf6a61ce/14b42/listening.jpg","srcSet":"/static/08d14f0668b061c1b7bb47aeaf6a61ce/f836f/listening.jpg 200w,\n/static/08d14f0668b061c1b7bb47aeaf6a61ce/2244e/listening.jpg 400w,\n/static/08d14f0668b061c1b7bb47aeaf6a61ce/14b42/listening.jpg 800w,\n/static/08d14f0668b061c1b7bb47aeaf6a61ce/47498/listening.jpg 1200w,\n/static/08d14f0668b061c1b7bb47aeaf6a61ce/ec6c5/listening.jpg 1280w","sizes":"(max-width: 800px) 100vw, 800px"}}}},"id":"fa4baa51-c7f7-5d85-aa70-0f66d3130f2a","html":"<h2>When should we use WebSocket?</h2>\n<p>With the increment of devices an application in IoT, we have found an increment of applications that are using WebSockets, but how do we define when to use this technology. Thus we have to define specific scenarios:</p>\n<ul>\n<li><strong>Constant Updates</strong> Imagine the following scenario, within a line of production, there are several workstations with automated machines or with PLC's that are sending constant data but also are sending several alerts and updates of their status. As a manager or data analyst, we need to process this data in real-time, without any request or petitions such as with <em>http</em>. Websockets are a good solution especially if the client doesn't know the amount of data and when can be received.</li>\n<li><strong>Fast Feedback</strong> Several PLC's models have digital or analog I/O, if a particular instruction needs to be executed in real-time, the client needs to know if that particular instruction was executed successfully or not, thus within the UI of our application feedback of the user's action needs to be reflected. Compared to REST, WebSocket allows a higher amount of efficiency, because they do not require the request/response overhead in <em>http</em>.</li>\n</ul>\n<h2>Data from the Server</h2>\n<p>The first thing to do is to analyze the data that comes from the server. To improve the UX, both sides server and Front-End have to concur in a common API and stablish the structure of the API. In this example, the server is sending the current state of two workstations <strong>0 and 1</strong>. Once the connection between the server and the client is established the first array is sent with the id's, name and state keys of each workstation. Then for each state change, the server is sending an object with the workstation id and state key.</p>\n<!-- markdownlint-disable MD033 MD010 -->\n<div class=\"gatsby-highlight\" data-language=\"js\"><pre class=\"language-js\"><code class=\"language-js\"><span class=\"token comment\">// JS code by PrismJS</span>\n\n<span class=\"token punctuation\">[</span><span class=\"token punctuation\">{</span><span class=\"token string\">\"ws_id\"</span><span class=\"token operator\">:</span> <span class=\"token number\">0</span><span class=\"token punctuation\">,</span> <span class=\"token string\">\"ws_name\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"engraving machine\"</span><span class=\"token punctuation\">,</span> <span class=\"token string\">\"states\"</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">{</span><span class=\"token string\">\"0\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"null\"</span><span class=\"token punctuation\">,</span> <span class=\"token string\">\"1\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"spindle\"</span><span class=\"token punctuation\">,</span> <span class=\"token string\">\"2\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"engraving\"</span><span class=\"token punctuation\">}</span><span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span> <span class=\"token punctuation\">{</span><span class=\"token string\">\"ws_id\"</span><span class=\"token operator\">:</span> <span class=\"token number\">1</span><span class=\"token punctuation\">,</span> <span class=\"token string\">\"ws_name\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"drill\"</span><span class=\"token punctuation\">,</span> <span class=\"token string\">\"states\"</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">{</span><span class=\"token string\">\"0\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"null\"</span><span class=\"token punctuation\">,</span> <span class=\"token string\">\"1\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"moving\"</span><span class=\"token punctuation\">,</span> <span class=\"token string\">\"2\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"drilling\"</span><span class=\"token punctuation\">,</span> <span class=\"token string\">\"3\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"playing\"</span><span class=\"token punctuation\">}</span><span class=\"token punctuation\">}</span><span class=\"token punctuation\">]</span>\n\n<span class=\"token punctuation\">{</span><span class=\"token string\">\"ws_id\"</span><span class=\"token operator\">:</span> <span class=\"token number\">1</span><span class=\"token punctuation\">,</span> <span class=\"token string\">\"state_key\"</span><span class=\"token operator\">:</span> <span class=\"token number\">2</span><span class=\"token punctuation\">}</span>\n\n<span class=\"token punctuation\">{</span><span class=\"token string\">\"ws_id\"</span><span class=\"token operator\">:</span> <span class=\"token number\">0</span><span class=\"token punctuation\">,</span> <span class=\"token string\">\"state_key\"</span><span class=\"token operator\">:</span> <span class=\"token number\">2</span><span class=\"token punctuation\">}</span></code></pre></div>\n<h2>Websocket Client</h2>\n<p>Within the Websocket Client the client establish connection to a server or a local machine, in this case is done through the port <em>4000</em>, then using the hook <strong>useContext</strong> we import the methods from the State context.</p>\n<div class=\"gatsby-highlight\" data-language=\"js\"><pre class=\"language-js\"><code class=\"language-js\"><span class=\"token keyword\">import</span> <span class=\"token punctuation\">{</span> useContext <span class=\"token punctuation\">}</span> <span class=\"token keyword\">from</span> <span class=\"token string\">\"react\"</span><span class=\"token punctuation\">;</span>\n<span class=\"token keyword\">import</span> <span class=\"token punctuation\">{</span> w3cwebsocket <span class=\"token keyword\">as</span> W3CWebSocket <span class=\"token punctuation\">}</span> <span class=\"token keyword\">from</span> <span class=\"token string\">\"websocket\"</span><span class=\"token punctuation\">;</span>\n<span class=\"token keyword\">import</span> ModelContext <span class=\"token keyword\">from</span> <span class=\"token string\">\"../../context/model/modelContext\"</span><span class=\"token punctuation\">;</span>\n\n<span class=\"token keyword\">export</span> <span class=\"token keyword\">const</span> client <span class=\"token operator\">=</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">W3CWebSocket</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"ws://localhost:4000\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n<span class=\"token keyword\">const</span> <span class=\"token function-variable function\">ModelWebsocket</span> <span class=\"token operator\">=</span> <span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\n  <span class=\"token keyword\">const</span> modelContext <span class=\"token operator\">=</span> <span class=\"token function\">useContext</span><span class=\"token punctuation\">(</span>ModelContext<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n  <span class=\"token keyword\">const</span> <span class=\"token punctuation\">{</span>\n    setUpModelMap<span class=\"token punctuation\">,</span>\n    setDataInModelMap<span class=\"token punctuation\">,</span>\n    setModelStatesColors<span class=\"token punctuation\">,</span>\n    getModelWebsocketStatus<span class=\"token punctuation\">,</span>\n    getModelWks<span class=\"token punctuation\">,</span>\n  <span class=\"token punctuation\">}</span> <span class=\"token operator\">=</span> modelContext<span class=\"token punctuation\">;</span>\n\n  client<span class=\"token punctuation\">.</span><span class=\"token function-variable function\">onerror</span> <span class=\"token operator\">=</span> <span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\n    <span class=\"token keyword\">try</span> <span class=\"token punctuation\">{</span>\n      console<span class=\"token punctuation\">.</span><span class=\"token function\">error</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"Connection Error with WebSocket Model\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n      <span class=\"token function\">getModelWebsocketStatus</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"ERROR\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token punctuation\">}</span> <span class=\"token keyword\">catch</span> <span class=\"token punctuation\">(</span>error<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n      console<span class=\"token punctuation\">.</span><span class=\"token function\">error</span><span class=\"token punctuation\">(</span>error<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token punctuation\">}</span>\n  <span class=\"token punctuation\">}</span><span class=\"token punctuation\">;</span>\n\n  client<span class=\"token punctuation\">.</span><span class=\"token function-variable function\">onopen</span> <span class=\"token operator\">=</span> <span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\n    <span class=\"token keyword\">try</span> <span class=\"token punctuation\">{</span>\n      console<span class=\"token punctuation\">.</span><span class=\"token function\">log</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"WebSocket Model Client Connected\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n      <span class=\"token function\">getModelWebsocketStatus</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"CONNECTING\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token punctuation\">}</span> <span class=\"token keyword\">catch</span> <span class=\"token punctuation\">(</span>error<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n      console<span class=\"token punctuation\">.</span><span class=\"token function\">error</span><span class=\"token punctuation\">(</span>error<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token punctuation\">}</span>\n  <span class=\"token punctuation\">}</span><span class=\"token punctuation\">;</span>\n\n  client<span class=\"token punctuation\">.</span><span class=\"token function-variable function\">onmessage</span> <span class=\"token operator\">=</span> <span class=\"token parameter\">message</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\n    <span class=\"token keyword\">try</span> <span class=\"token punctuation\">{</span>\n      message <span class=\"token operator\">=</span> <span class=\"token constant\">JSON</span><span class=\"token punctuation\">.</span><span class=\"token function\">parse</span><span class=\"token punctuation\">(</span>message<span class=\"token punctuation\">.</span>data<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n      <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span>Array<span class=\"token punctuation\">.</span><span class=\"token function\">isArray</span><span class=\"token punctuation\">(</span>message<span class=\"token punctuation\">)</span> <span class=\"token operator\">&amp;&amp;</span> message<span class=\"token punctuation\">.</span>length <span class=\"token operator\">></span> <span class=\"token number\">0</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n        <span class=\"token comment\">// Gets the initial array of workstations</span>\n        <span class=\"token function\">getModelWks</span><span class=\"token punctuation\">(</span>message<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n        <span class=\"token function\">setUpModelMap</span><span class=\"token punctuation\">(</span>message<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n        <span class=\"token function\">setModelStatesColors</span><span class=\"token punctuation\">(</span>message<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n      <span class=\"token punctuation\">}</span> <span class=\"token keyword\">else</span> <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span><span class=\"token keyword\">typeof</span> message <span class=\"token operator\">===</span> <span class=\"token string\">\"object\"</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n        <span class=\"token comment\">// Starts the dictionary structure and the data from the websocket</span>\n        <span class=\"token function\">setDataInModelMap</span><span class=\"token punctuation\">(</span>message<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n        <span class=\"token function\">getModelWebsocketStatus</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"OPEN\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n      <span class=\"token punctuation\">}</span>\n    <span class=\"token punctuation\">}</span> <span class=\"token keyword\">catch</span> <span class=\"token punctuation\">(</span>error<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n      console<span class=\"token punctuation\">.</span><span class=\"token function\">error</span><span class=\"token punctuation\">(</span>error<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token punctuation\">}</span>\n  <span class=\"token punctuation\">}</span><span class=\"token punctuation\">;</span>\n\n  <span class=\"token keyword\">return</span> <span class=\"token keyword\">null</span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span><span class=\"token punctuation\">;</span>\n\n<span class=\"token keyword\">export</span> <span class=\"token keyword\">default</span> ModelWebsocket<span class=\"token punctuation\">;</span></code></pre></div>\n<p><em>websocket.js</em></p>\n<h2>React Context</h2>\n<p>Exporting Context so it can be used in other components within the app.</p>\n<div class=\"gatsby-highlight\" data-language=\"js\"><pre class=\"language-js\"><code class=\"language-js\"><span class=\"token keyword\">import</span> <span class=\"token punctuation\">{</span> createContext <span class=\"token punctuation\">}</span> <span class=\"token keyword\">from</span> <span class=\"token string\">\"react\"</span><span class=\"token punctuation\">;</span>\n\n<span class=\"token keyword\">const</span> modelContext <span class=\"token operator\">=</span> <span class=\"token function\">createContext</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n<span class=\"token keyword\">export</span> <span class=\"token keyword\">default</span> modelContext<span class=\"token punctuation\">;</span></code></pre></div>\n<p><em>modelContext.js</em></p>\n<h2>State</h2>\n<p>Here we set the initial state, where the workstations and data from the server in stored. Then we use the <strong>useReducer</strong> hook to pass the reducer and context to manipulate the state and dispatch the types. At the end of the file we pass the whole state and the methods that can be used in other components through the Context Provider. To store the data from different workstations, we used a <strong>Map()</strong> data structure, so we could access data in parallel.</p>\n<div class=\"gatsby-highlight\" data-language=\"js\"><pre class=\"language-js\"><code class=\"language-js\"><span class=\"token keyword\">import</span> React<span class=\"token punctuation\">,</span> <span class=\"token punctuation\">{</span> useReducer <span class=\"token punctuation\">}</span> <span class=\"token keyword\">from</span> <span class=\"token string\">\"react\"</span><span class=\"token punctuation\">;</span>\n<span class=\"token keyword\">import</span> ModelContext <span class=\"token keyword\">from</span> <span class=\"token string\">\"./modelContext\"</span><span class=\"token punctuation\">;</span>\n<span class=\"token keyword\">import</span> ModelReducer <span class=\"token keyword\">from</span> <span class=\"token string\">\"./modelReducer\"</span><span class=\"token punctuation\">;</span>\n<span class=\"token keyword\">import</span> <span class=\"token punctuation\">{</span>\n  <span class=\"token constant\">GET_MODEL_WKS</span><span class=\"token punctuation\">,</span>\n  <span class=\"token constant\">SET_MODEL_MAP</span><span class=\"token punctuation\">,</span>\n  <span class=\"token constant\">SET_MODEL_COLORS</span><span class=\"token punctuation\">,</span>\n  <span class=\"token constant\">GET_MODEL_WEBSOCKET_STATUS</span><span class=\"token punctuation\">,</span>\n<span class=\"token punctuation\">}</span> <span class=\"token keyword\">from</span> <span class=\"token string\">\"../types\"</span><span class=\"token punctuation\">;</span>\n<span class=\"token keyword\">import</span> <span class=\"token punctuation\">{</span> getRandColor <span class=\"token punctuation\">}</span> <span class=\"token keyword\">from</span> <span class=\"token string\">\"../../assets/libs/helperFunctions\"</span><span class=\"token punctuation\">;</span>\n\n<span class=\"token keyword\">const</span> <span class=\"token function-variable function\">ModelState</span> <span class=\"token operator\">=</span> <span class=\"token parameter\">props</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\n  <span class=\"token keyword\">const</span> initialState <span class=\"token operator\">=</span> <span class=\"token punctuation\">{</span>\n    wks<span class=\"token operator\">:</span> <span class=\"token punctuation\">[</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">,</span>\n    wksMap<span class=\"token operator\">:</span> <span class=\"token punctuation\">{</span><span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span>\n    wksStatesColors<span class=\"token operator\">:</span> <span class=\"token punctuation\">{</span><span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span>\n    websocketStatus<span class=\"token operator\">:</span> <span class=\"token string\">\"\"</span><span class=\"token punctuation\">,</span>\n  <span class=\"token punctuation\">}</span><span class=\"token punctuation\">;</span>\n\n  <span class=\"token keyword\">const</span> <span class=\"token punctuation\">[</span>state<span class=\"token punctuation\">,</span> dispatch<span class=\"token punctuation\">]</span> <span class=\"token operator\">=</span> <span class=\"token function\">useReducer</span><span class=\"token punctuation\">(</span>ModelReducer<span class=\"token punctuation\">,</span> initialState<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n  <span class=\"token comment\">// Set up Map data structure with workstations ids as keys and 50 Arrays fill with -1 as values</span>\n  <span class=\"token keyword\">const</span> <span class=\"token function-variable function\">setUpModelMap</span> <span class=\"token operator\">=</span> <span class=\"token parameter\">wks</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\n    <span class=\"token keyword\">try</span> <span class=\"token punctuation\">{</span>\n      <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span>wks<span class=\"token punctuation\">.</span>length <span class=\"token operator\">></span> <span class=\"token number\">0</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n        <span class=\"token keyword\">const</span> wksMap <span class=\"token operator\">=</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">Map</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n        wks<span class=\"token punctuation\">.</span><span class=\"token function\">forEach</span><span class=\"token punctuation\">(</span><span class=\"token parameter\">workstation</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\n          wksMap<span class=\"token punctuation\">.</span><span class=\"token function\">set</span><span class=\"token punctuation\">(</span>workstation<span class=\"token punctuation\">.</span>ws_id<span class=\"token punctuation\">,</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">Array</span><span class=\"token punctuation\">(</span><span class=\"token number\">50</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">fill</span><span class=\"token punctuation\">(</span><span class=\"token operator\">-</span><span class=\"token number\">1</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n        <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n        <span class=\"token function\">dispatch</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">{</span>\n          type<span class=\"token operator\">:</span> <span class=\"token constant\">SET_MODEL_MAP</span><span class=\"token punctuation\">,</span>\n          payload<span class=\"token operator\">:</span> wksMap<span class=\"token punctuation\">,</span>\n        <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n      <span class=\"token punctuation\">}</span>\n    <span class=\"token punctuation\">}</span> <span class=\"token keyword\">catch</span> <span class=\"token punctuation\">(</span>error<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n      console<span class=\"token punctuation\">.</span><span class=\"token function\">error</span><span class=\"token punctuation\">(</span>error<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token punctuation\">}</span>\n  <span class=\"token punctuation\">}</span><span class=\"token punctuation\">;</span>\n\n  <span class=\"token comment\">// Creates a Map Data structure to store an object with an object holding all states and its corresponding color</span>\n  <span class=\"token keyword\">const</span> <span class=\"token function-variable function\">setModelStatesColors</span> <span class=\"token operator\">=</span> <span class=\"token parameter\">wks</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\n    <span class=\"token keyword\">try</span> <span class=\"token punctuation\">{</span>\n      <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span>wks<span class=\"token punctuation\">.</span>length <span class=\"token operator\">></span> <span class=\"token number\">0</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n        <span class=\"token keyword\">const</span> wksStatesColors <span class=\"token operator\">=</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">Map</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n        wks<span class=\"token punctuation\">.</span><span class=\"token function\">forEach</span><span class=\"token punctuation\">(</span><span class=\"token parameter\">workstation</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\n          <span class=\"token keyword\">const</span> colorStates <span class=\"token operator\">=</span> <span class=\"token punctuation\">{</span><span class=\"token punctuation\">}</span><span class=\"token punctuation\">;</span>\n          Object<span class=\"token punctuation\">.</span><span class=\"token function\">values</span><span class=\"token punctuation\">(</span>workstation<span class=\"token punctuation\">.</span>states<span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">forEach</span><span class=\"token punctuation\">(</span><span class=\"token parameter\">state</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\n            colorStates<span class=\"token punctuation\">[</span>state<span class=\"token punctuation\">]</span> <span class=\"token operator\">=</span> <span class=\"token function\">getRandColor</span><span class=\"token punctuation\">(</span><span class=\"token number\">5</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n          <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n          wksStatesColors<span class=\"token punctuation\">.</span><span class=\"token function\">set</span><span class=\"token punctuation\">(</span>workstation<span class=\"token punctuation\">.</span>ws_id<span class=\"token punctuation\">,</span> colorStates<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n        <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n        <span class=\"token function\">dispatch</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">{</span>\n          type<span class=\"token operator\">:</span> <span class=\"token constant\">SET_MODEL_COLORS</span><span class=\"token punctuation\">,</span>\n          payload<span class=\"token operator\">:</span> wksStatesColors<span class=\"token punctuation\">,</span>\n        <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n      <span class=\"token punctuation\">}</span>\n    <span class=\"token punctuation\">}</span> <span class=\"token keyword\">catch</span> <span class=\"token punctuation\">(</span>error<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n      console<span class=\"token punctuation\">.</span><span class=\"token function\">error</span><span class=\"token punctuation\">(</span>error<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token punctuation\">}</span>\n  <span class=\"token punctuation\">}</span><span class=\"token punctuation\">;</span>\n\n  <span class=\"token comment\">// Shift the first state_key values and push the income state_key values on its corresponding array, within the labeler map structure</span>\n  <span class=\"token keyword\">const</span> <span class=\"token function-variable function\">setDataInModelMap</span> <span class=\"token operator\">=</span> <span class=\"token parameter\">data</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\n    <span class=\"token keyword\">try</span> <span class=\"token punctuation\">{</span>\n      <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span>state<span class=\"token punctuation\">.</span>wksMap<span class=\"token punctuation\">.</span>size <span class=\"token operator\">></span> <span class=\"token number\">0</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n        <span class=\"token keyword\">for</span> <span class=\"token punctuation\">(</span><span class=\"token keyword\">const</span> <span class=\"token punctuation\">[</span>wks_id<span class=\"token punctuation\">,</span> stateKeyValuesArray<span class=\"token punctuation\">]</span> <span class=\"token keyword\">of</span> state<span class=\"token punctuation\">.</span>wksMap<span class=\"token punctuation\">.</span><span class=\"token function\">entries</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n          <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span>data<span class=\"token punctuation\">.</span>ws_id <span class=\"token operator\">===</span> <span class=\"token function\">parseInt</span><span class=\"token punctuation\">(</span>wks_id<span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n            stateKeyValuesArray<span class=\"token punctuation\">.</span><span class=\"token function\">shift</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n            stateKeyValuesArray<span class=\"token punctuation\">.</span><span class=\"token function\">push</span><span class=\"token punctuation\">(</span>data<span class=\"token punctuation\">.</span>state_key<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n          <span class=\"token punctuation\">}</span>\n        <span class=\"token punctuation\">}</span>\n      <span class=\"token punctuation\">}</span>\n    <span class=\"token punctuation\">}</span> <span class=\"token keyword\">catch</span> <span class=\"token punctuation\">(</span>error<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n      console<span class=\"token punctuation\">.</span><span class=\"token function\">error</span><span class=\"token punctuation\">(</span>error<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token punctuation\">}</span>\n  <span class=\"token punctuation\">}</span><span class=\"token punctuation\">;</span>\n\n  <span class=\"token comment\">// Get WebsocketStatus</span>\n  <span class=\"token keyword\">const</span> <span class=\"token function-variable function\">getModelWebsocketStatus</span> <span class=\"token operator\">=</span> <span class=\"token parameter\">status</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\n    <span class=\"token function\">dispatch</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">{</span>\n      type<span class=\"token operator\">:</span> <span class=\"token constant\">GET_MODEL_WEBSOCKET_STATUS</span><span class=\"token punctuation\">,</span>\n      payload<span class=\"token operator\">:</span> status<span class=\"token punctuation\">,</span>\n    <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n  <span class=\"token punctuation\">}</span><span class=\"token punctuation\">;</span>\n\n  <span class=\"token comment\">// Get Workstations from the API</span>\n  <span class=\"token keyword\">const</span> <span class=\"token function-variable function\">getModelWks</span> <span class=\"token operator\">=</span> <span class=\"token parameter\">wks</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\n    <span class=\"token function\">dispatch</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">{</span>\n      type<span class=\"token operator\">:</span> <span class=\"token constant\">GET_MODEL_WKS</span><span class=\"token punctuation\">,</span>\n      payload<span class=\"token operator\">:</span> wks<span class=\"token punctuation\">,</span>\n    <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n  <span class=\"token punctuation\">}</span><span class=\"token punctuation\">;</span>\n\n  <span class=\"token keyword\">return</span> <span class=\"token punctuation\">(</span>\n    <span class=\"token operator\">&lt;</span>ModelContext<span class=\"token punctuation\">.</span>Provider\n      value<span class=\"token operator\">=</span><span class=\"token punctuation\">{</span><span class=\"token punctuation\">{</span>\n        wks<span class=\"token operator\">:</span> state<span class=\"token punctuation\">.</span>wks<span class=\"token punctuation\">,</span>\n        wksMap<span class=\"token operator\">:</span> state<span class=\"token punctuation\">.</span>wksMap<span class=\"token punctuation\">,</span>\n        wksStatesColors<span class=\"token operator\">:</span> state<span class=\"token punctuation\">.</span>wksStatesColors<span class=\"token punctuation\">,</span>\n        websocketStatus<span class=\"token operator\">:</span> state<span class=\"token punctuation\">.</span>websocketStatus<span class=\"token punctuation\">,</span>\n        setUpModelMap<span class=\"token punctuation\">,</span>\n        setModelStatesColors<span class=\"token punctuation\">,</span>\n        setDataInModelMap<span class=\"token punctuation\">,</span>\n        getModelWebsocketStatus<span class=\"token punctuation\">,</span>\n        getModelWks<span class=\"token punctuation\">,</span>\n      <span class=\"token punctuation\">}</span><span class=\"token punctuation\">}</span>\n    <span class=\"token operator\">></span>\n      <span class=\"token punctuation\">{</span>props<span class=\"token punctuation\">.</span>children<span class=\"token punctuation\">}</span>\n    <span class=\"token operator\">&lt;</span><span class=\"token operator\">/</span>ModelContext<span class=\"token punctuation\">.</span>Provider<span class=\"token operator\">></span>\n  <span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span><span class=\"token punctuation\">;</span>\n\n<span class=\"token keyword\">export</span> <span class=\"token keyword\">default</span> ModelState<span class=\"token punctuation\">;</span></code></pre></div>\n<p><em>modelState.js</em></p>","excerpt":"When should we use WebSocket? With the increment of devices an application in IoT, we have found an increment of applications that are usingâ€¦"}},"pageContext":{"type":"posts","next":{"frontmatter":{"path":"/spinner-loading","title":"Display Spinner while loading data","tags":["react","react hooks"]},"fileAbsolutePath":"/home/hugo/Sites/Personal/hugoiramirez.com/src/posts/March_20_2020_Spinner_Loading.md"},"previous":null}}}